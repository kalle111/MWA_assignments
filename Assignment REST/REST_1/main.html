<!DOCTYPE html>

<html>
    
<head>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.1.0.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <!--<script src="C:\Users\kalle\Documents\mwa\Assignment REST\REST_1\libs\jquery-3.1.0.js"></script> -->
    <script>
        window.onload = function () {
            console.log('Beginne Selection-Fetch:');
            //insertSelectionOptions();
        }
        var preFetch1 = "";
        //var preFetch = "";
        function insertSelectionOptions() {
            console.log('inside insertSelectionOptions');
            //Logic to pre-fetch selection data
            let searchConstraints = "";
            let result = "";
            result = preFetch();
            //console.log(result); => gibt null zur√ºck
            console.log("Result in Button-Func: ");
            console.log(result);
            /*let a = result.responseJSON;
            console.log("neuer log: " + a.Legend);*/
        }
        function getSelectedIndex() {
            console.log($("#customer_type").prop('selectedIndex'));
        }

        function testGet() {
            let searchConstraints = {id: "", name: "", address: "", customer_type: ""};
            searchConstraints.id = $("#filterFieldID")[0].value;
            //searchConstraints.id = this.document.getElementById("filterFieldID").value;
            searchConstraints.name = $("#filterFieldName")[0].value;
            searchConstraints.address = $("#filterFieldAddress")[0].value;
            searchConstraints.customer_type = $("#customer_type_selection").find(":selected").val();
            //searchConstraints.name = this.document.getElementById("filterFieldName").value;
            if(searchConstraints.id) {
                console.log("Filterfield has input: " + searchConstraints.id);
            } else {
                console.log("Filterfield has no input");
            }
            //searchConstraints.name = $("#filterFieldName").val();
            callAjax({url: "http://localhost:3031/allcustomers/", type : "GET", data : searchConstraints});
                
        }
        function handleData(result) {
            return result;
        }
        function callAjax(param)
        {
            console.log("Ajax-Call-Funktion gestartet");
            let result = null;
            let result1 = "nothing";
            result = $.ajax(
            {
                url: param.url,
                method: param.type,
                data: param.data
            }).done(function( data, textStatus, jqXHR){
                console.log("result: ", data);
                console.log("status code: ", jqXHR.status);
                //handleData(result);
            }).fail(function(jqXHR, textStatus, errorThrown){
                console.log("Call failed (AJAX-CALL failed): " + errorThrown);
                console.log("status code: " + jqXHR.status);
            });
            return result;
        }

        function preFetch()
        {
            console.log("PreFetching gestartet");
            let result;
            let responsetxt;

            result = $.ajax(
            {
                url: "http://localhost:3031/customer_type_fetch/",
                method: "GET",
                data: "",
                async: true
            }).done( function( data, textStatus, jqXHR){
                console.log("result: ", data);
                console.log("status code: ", jqXHR.status);
                //handleData(result);
                console.log('####');
                //console.log(result.responseText);
                dataHandler(data);
            }).fail(function(jqXHR, textStatus, errorThrown){
                console.log("Call failed (AJAX-CALL failed): " + errorThrown);
                console.log("status code: " + jqXHR.status);
            });
            //alert('jetzt kommt der consolelog');
            function dataHandler(rspns) {
                var dropdown = this.document.getElementById("customer_type_selection");
                let htmlSelection = "<option value=0></option>";
                console.log(rspns);
               // let htmlSelection = "<option value=0 selected></option>";
                for(i = 0; i<rspns.length; i++) {
                    htmlSelection += "<option value="+i+">"+rspns[i].Legend+"</options>";
                }
                dropdown.innerHTML = htmlSelection;
            }
            //let typeSelection = $("#customer_type_selection");
            
            //for(i = 0; i<result.length; i++)
         }
    </script>
<title>Page Title</title>
</head>
<body>

<div id="FilterAndFetchDiv">
    <table id="td1" style="text-align:center; border: 1px solid black;padding-top:0px">
    Filter:
    <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Address</th>
        <th>Customer_Type</th>
    </tr>
    <tr>
        <td><input id=filterFieldID type="text"></td>
        <td><input id=filterFieldName type="text"></td>
        <td><input id=filterFieldAddress type="text"></td>
        <td><select id="customer_type_selection">
            <option value=0 selected></option>
            <option value=1>CustomerType1</option>
            <option value=2>CustomerType2</option>
        </select></td>
    </tr>
    </table>
    <br>
    <button id="getAll" name="getall" type="button" onclick="testGet()" style="width: 250px; height:30px">Get Data</button>
    <button id="getselectedprops" onclick="preFetch()">GetSelIndexJquery</button>
</div>
<div id="OutputDiv" style="visibility: hidden">
    something
</div>
</body>
</html>